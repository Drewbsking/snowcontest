<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>White Lake Snowfall Contest Tracker</title>

<link rel="stylesheet" href="styles.css" />
</head>
<body>
<div class="snow-layer" aria-hidden="true"></div>
<div class="top-bar">
  <div class="brand-block">
    <img src="rcoc-logo.jpg" alt="RCOC logo" class="brand-logo" />
    <div class="brand-text">
      <span class="brand-title">RCOC Snowfall Contest</span>
      <span class="brand-sub">White Lake, MI · Seasonal Snow Tracker</span>
    </div>
  </div>
  <nav class="top-nav">
    <a href="rules.html">Contest Rules</a>
    <a href="winners.html">Past Winners</a>
  </nav>
</div>
<div class="wrap">
  <!-- LEFT: Totals / Selector -->
  <section class="card" id="total-card">
    <div class="totals-head-row">
      <div class="totals-meta">
        <div class="totals-meta-line" id="station-label">
          Loading station…
        </div>
        <div class="totals-meta-line" id="season-label">
          Season …
        </div>
        <div class="totals-meta-line" id="contest-date-label">
          Contest dates …
        </div>
        <div class="totals-meta-line" id="seasonal-range-label">
          Seasonal snow year …
        </div>
      </div>

      <div class="season-picker-block">
        <label for="seasonSelect">Contest Season</label>
        <select id="seasonSelect"></select>
      </div>
    </div>

    <div class="totals-grid">
      <div class="total-box">
        <div class="total-subhead">Contest Total</div>
        <div class="total-value" id="contest-total-value">--</div>
        <div class="total-note">Dec&nbsp;1 → Mar&nbsp;31 snowfall</div>
      </div>
      <div class="total-box">
        <div class="total-subhead">Seasonal Total</div>
        <div class="total-value" id="seasonal-total-value">--</div>
        <div class="total-note">Jul&nbsp;1 → Jun&nbsp;30 snowfall</div>
      </div>
      <div class="total-box">
        <div class="total-subhead">Largest Daily Storm</div>
        <div class="total-value" id="largest-storm-value">--</div>
        <div class="total-note" id="largest-storm-note">Awaiting data…</div>
      </div>
      <div class="total-box">
        <div class="total-subhead">Snow Drought</div>
        <div class="total-value" id="snow-drought-value">--</div>
        <div class="total-note" id="snow-drought-note">Days since ≥0.1"</div>
      </div>
      <div class="total-box">
        <div class="total-subhead">Avg Snowy Day</div>
        <div class="total-value" id="average-snow-value">--</div>
        <div class="total-note" id="average-snow-note">Across measurable days</div>
      </div>
      <div class="total-box">
        <div class="total-subhead">First Snowfall</div>
        <div class="total-value" id="first-snow-value">--</div>
        <div class="total-note" id="first-snow-note">Awaiting ≥0.1" snow</div>
      </div>
      <div class="total-box">
        <div class="total-subhead">Last Snowfall</div>
        <div class="total-value" id="last-snow-value">--</div>
        <div class="total-note" id="last-snow-note">Awaiting ≥0.1" snow</div>
      </div>
    </div>

    <div class="footnote">
      Source:
      <a href="https://data.rcc-acis.org/" target="_blank" rel="noopener noreferrer">
        NOAA ACIS (White Lake station)
      </a>.
      Missing days = "M". "T" = trace (&lt;0.1"), counted as 0.0 in totals.
      <br/><br/>
      Bars = daily snowfall. Lines = cumulative contest total (Dec&nbsp;1 → Mar&nbsp;31) and
      seasonal total (Jul&nbsp;1 → Jun&nbsp;30).
      Shaded region marks the contest window.
    </div>

  </section>

  <!-- RIGHT: Chart -->
  <section class="card" id="chart-card">
    <div class="chart-card-header">
      <span>Daily Snow vs Cumulative Total</span>
      <span class="chart-sub">
        Bars = daily snowfall (inches).
        Lines = cumulative snowfall for the contest window (Dec&nbsp;1 → Mar&nbsp;31)
        and the full snow year (Jul&nbsp;1 → Jun&nbsp;30).
        Shaded area shows in-season contest days.
      </span>
      <div class="data-toolbar">
        <a id="json-link" class="data-link" href="#" target="_blank" rel="noopener">View Raw JSON</a>
        <span class="data-sep">·</span>
        <a id="csv-link" class="data-link" href="#" download>Download CSV</a>
        <span class="data-sep">·</span>
        <span id="data-source" class="data-source">Source: NOAA ACIS – White Lake 4E</span>
      </div>
    </div>

    <div class="chart-box">
      <!-- loading overlay sits on top of the canvas -->
      <div class="loading-overlay" id="loading-overlay">
        <div class="spinner"></div>
        <div>Loading snowfall data…</div>
      </div>
      <div class="no-snow-message" id="no-snow-message">
        No snowfall has been recorded yet this season.
      </div>
      <canvas id="snowChart" aria-label="Daily snowfall bar chart and cumulative snowfall line chart" role="img"></canvas>
    </div>
  </section>

  <section class="card" id="contest-results-card">
    <div class="chart-card-header">
      <span>Contest Leaders</span>
      <span class="chart-sub">
        Official contest uses closest-without-going-over scoring for Dec&nbsp;2 → Mar&nbsp;31 snowfall.
        Seasonal totals (Jul&nbsp;1 → Jun&nbsp;30) earn unofficial bragging rights only.
      </span>
    </div>

    <div class="result-line" id="contest-results-season">
      Loading season standings…
    </div>

    <div class="result-line">
      <div class="result-subhead">Official Contest · Dec&nbsp;2 → Mar&nbsp;31</div>
      <div id="official-result-body" class="result-detail">Loading official standings…</div>
    </div>

    <div class="result-line">
      <div class="result-subhead">Seasonal Total · Jul&nbsp;1 → Jun&nbsp;30 (Unofficial)</div>
      <div id="seasonal-result-body" class="result-detail">Loading seasonal standings…</div>
    </div>
  </section>

  <section class="card" id="guess-stats-card">
    <div class="chart-card-header">
      <span>Guess Insights</span>
      <span class="chart-sub">
        Snapshot of all contest submissions for the selected season.
      </span>
    </div>
    <div class="data-toolbar guess-data-toolbar">
      <a id="guess-csv-link" class="data-link" href="#" aria-disabled="true">Download Guess CSV</a>
    </div>

    <div class="guess-stats-grid">
      <div class="guess-stat-box">
        <div class="guess-stat-label">Average Guess</div>
        <div class="guess-stat-value" id="guess-avg-value">--</div>
        <div class="guess-stat-note" id="guess-avg-note">Awaiting data…</div>
      </div>
      <div class="guess-stat-box">
        <div class="guess-stat-label">Lowest Guess</div>
        <div class="guess-stat-value" id="guess-low-value">--</div>
        <div class="guess-stat-note" id="guess-low-note">Awaiting data…</div>
      </div>
      <div class="guess-stat-box">
        <div class="guess-stat-label">Highest Guess</div>
        <div class="guess-stat-value" id="guess-high-value">--</div>
        <div class="guess-stat-note" id="guess-high-note">Awaiting data…</div>
      </div>
    </div>

    <div class="guess-chart-box">
      <canvas id="guessHistogram" aria-label="Guess distribution histogram" role="img"></canvas>
    </div>
  </section>

  <!-- WeatherStar Embed -->
  <section class="card weatherstar-card" aria-labelledby="weatherstar-heading">
    <div class="chart-card-header">
      <span id="weatherstar-heading">WeatherStar 4000+ Forecast</span>
      <span class="chart-sub">
        Automated forecast loop for White Lake, MI with every display and scan lines enabled.
      </span>
    </div>
    <div class="weatherstar-embed">
      <iframe
        src="ws4kp/index.html?embed=1&amp;latLonQuery=White+Lake%2C+MI"
        title="WeatherStar 4000+ forecast for White Lake, Michigan"
        loading="lazy"
        allowfullscreen
      ></iframe>
    </div>
  </section>

</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
<script src="app.js"></script>
<footer class="site-footer">
  <div class="footer-wrap">
    <span id="data-updated">Data updated —</span>
    <span class="footer-sep">·</span>
    <span>Crafted by Andrew Bates</span>
    <span class="footer-sep">·</span>
    <a class="footer-link" href="https://github.com/netbymatt/ws4kp" target="_blank" rel="noopener">
      WeatherStar 4000+ by Matt Walsh
    </a>
    <span class="footer-sep">·</span>
    <span class="footer-source">Powered by NOAA ACIS</span>
  </div>
</footer>
</body>
</html>
